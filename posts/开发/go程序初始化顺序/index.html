<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.101.0"><title>go程序初始化顺序 | Gonejack</title><meta name=description content="Gonejack's blog"><link rel=stylesheet href=https://gonejack.github.io/css/simpleness.css><link rel=canonical href=https://gonejack.github.io/posts/%E5%BC%80%E5%8F%91/go%E7%A8%8B%E5%BA%8F%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%BA%E5%BA%8F/><link rel=alternate type=application/rss+xml href title=Gonejack><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css rel=stylesheet></head><body class=container><nav class=navigation><div class=nav-left><div class="nav-item nav-title"><a href=https://gonejack.github.io/>Gonejack</a></div><div class="nav-item nav-menu"><a href=/projects/>Projects</a>
<a href=/about/>About</a></div></div><div class="nav-item nav-right fontawesome"><a href=https://github.com/gonejack target=_blank><i title=GitHub class="fab fa-github"></i></a>
<a href=https://gonejack.github.io/index.xml target=_blank><i title=RSS class="fas fa-rss"></i></a></div></nav><article class=post><header class=post-header><h1 style=text-align:center>go程序初始化顺序</h1><div class=post-metadata><time datetime=2020-12-01T12:51:14Z>December 01, 2020</time> &nbsp;
<i class="far fa-clock"></i>
3 min
39 s
&nbsp;
<i class="fas fa-folder"></i>
<a href=/categories/%E5%BC%80%E5%8F%91>开发</a>
&nbsp;</div></header><div class=post-text><p>在一个 go 程序中通常包含：包、常量、变量、init()、main()等元素，如果同时存在多个包，包之间存在依赖关系，每个包中存在多个 init 函数，每个文件中存在多个 init 函数，那么问题来了，他们之间的执行顺序是什么样的？通过本文我们来对它们之间的执行顺序做尽可能详尽的说明。如有不正之处，欢迎批评指正。</p><h3 id=包的执行顺序>包的执行顺序</h3><ul><li>在 main 包中的 go 文件默认总是会被执行</li><li>同包下的不同 go 文件，按照文件名“从小到大”排序顺序执行</li><li>其他的包只有被 main 包 import 才会执行，按照 import 的先后顺序执行</li><li>被递归 import 的包的初始化顺序与 import 顺序相反，例如：导入顺序 main –> A –> B –> C，则初始化顺序为 C –> B –> A –> main</li><li>一个包被其它多个包 import，但只能被初始化一次</li><li>main 包总是被最后一个初始化，因为它总是依赖别的包</li><li>避免出现循环 import，例如：A –> B –> C –> A</li></ul><p>go 程序的初始化顺序见下图：</p><p><img src=assets/20170831112523944.jpeg alt></p><h3 id=init-和-main-函数>init 和 main 函数</h3><p>init()、main() 是 go 语言中的保留函数，两个函数在 go 语言中的区别如下：
相同点：</p><ul><li>两个函数在定义时不能有任何的参数和返回值</li><li>该函数只能由 go 程序自动调用，不可以被引用</li></ul><p>不同点：</p><ul><li>init 可以应用于任意包中，且可以重复定义多个。</li><li>main 函数只能用于 main 包中，且只能定义一个。</li></ul><p>两个函数的执行顺序：</p><ul><li>对同一个 go 文件的 init( ) 调用顺序是从上到下的</li><li>对同一个 package 中的不同文件，将文件名按字符串进行“从小到大”排序，之后顺序调用各文件中的init()函数</li><li>对于不同的 package，如果不相互依赖的话，按照 main 包中 import 的顺序调用其包中的 init() 函数</li><li>如果 package 存在依赖，调用顺序为最后被依赖的最先被初始化，例如：导入顺序 main –> A –> B –> C，则初始化顺序为 C –> B –> A –> main，一次执行对应的 init 方法。</li></ul><h3 id=常量变量initmain>常量、变量、init()、main()</h3><p>在同一个文件中，常量、变量、init()、main() 依次进行初始化。</p><p><a href=https://blog.csdn.net/claram/article/details/77745665>go编程：浅析go程序初始化顺序</a></p></div><footer class=post-footer><div class=post-tags><i class="fas fa-tags"></i>
<a href=/tags/golang>golang</a>
&nbsp;</div></footer><div class=comments><div class=comments></div></div></article><div class=foot>&copy; 2020 - 2022 &#183;
<a href=/>Gonejack</a> &#183;
Theme <a href=https://github.com/RainerChiang/simpleness>Simpleness</a> Powered by <a href=https://gohugo.io/>Hugo</a> &#183;
<a href=#><i class="fas fa-chevron-up"></i></a></div></body><script src=/js/lazyload.min.js></script>
<script>var lazyImage=new LazyLoad({container:document.getElementById("article")})</script></html>